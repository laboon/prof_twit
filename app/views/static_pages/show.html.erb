
<h1>Results</h1>
Results for <%= params[:twitname] %><p>
<%
require 'rubygems'
require 'twitter'

def get_timeline(username)

  timeline = Twitter.user_timeline(username)
  all_text = ""
  unless timeline.empty?
    last_id = timeline[0].id
    timeline.each do|st|
      all_text = all_text + "#{st.text}"
      # puts "#{st.text}"
    end
  end
  return all_text
end

def clear_punc (arr)
  toReturn = []
  arr.each { |elem| toReturn.push(elem.gsub!(/[^0-9a-z]*/i, '')) }
  return toReturn
end

def count_words ( arr )
  words = Hash.new
  arr.each {
    |word|
    if (words.has_key?(word))
      
      val = words[word]
      val += 1
      words[word] = val
      # puts "word repeated " + word + "( " + val.to_s() + " )"
    else 
      # puts "new word " + word
      words[word] = 1
    end
  }
  return words
end

def print_stats (word_counts)
  to_return = ""
  top_words = Hash[*word_counts.sort_by { |k,v| -v }[0..9].flatten]
  puts top_words
  top_words.sort{|a,b| -(a[1]<=>b[1])}.each { |elem|
    to_return = to_return + "#{elem[1]} -> #{elem[0]}<br>"
  }
  # puts to_return
  return to_return
end

username = params[:twitname]

timeline_text = get_timeline(username)

# puts all_text
word_arr = timeline_text.split
word_arr = clear_punc(word_arr)
word_counts = count_words(word_arr)
tmp = print_stats(word_counts)

%>
<%= tmp %>  

<p><a href="/static_pages/home">Try again</a>

